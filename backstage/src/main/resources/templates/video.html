<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="baiduspider" content="noindex, nofollow">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
    <meta http-equiv="x-dns-prefetch-control" content="off">
    <meta name="referrer" content="no-referrer">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="format-detection" content="telephone=no, email=no, address=no">
    <title>ç”Ÿå¦‚å¤èŠ±ä¹‹ç»šçƒ‚ï¼Œæ­»å¦‚ç§‹å¶ä¹‹é™ç¾</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.7.4/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šä¹‰æ ·å¼ */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        @media (min-width: 640px) {
            .video-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .video-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .video-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 1280px) {
            .video-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .video-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 æ¯”ä¾‹ */
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .video-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }

        .video-platform-tag {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .video-platform-tag.cursor-pointer:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }



        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-card:hover .play-button {
            opacity: 1;
        }

        .line-clamp-1 {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90vw;
            max-height: 90vh;
            overflow: auto;
        }

        /* å¯¼èˆªæ å›ºå®š */
        .nav-container {
            position: sticky;
            top: 0;
            z-index: 50;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 40;
        }

        .loading-spinner.show {
            opacity: 1;
            visibility: visible;
        }


        .spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* éª¨æ¶å±åŠ¨ç”» */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .skeleton {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #f6f7f8 4%, #edeef1 25%, #f6f7f8 36%);
            background-size: 1000px 100%;
        }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination-container {
            text-align: center;
            padding: 1.5rem 1rem;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .pagination-container .page-btn {
            min-width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination-container .page-btn:hover:not(.active):not(:disabled) {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .pagination-container .page-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        .pagination-container .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-container .page-ellipsis {
            min-width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
        }



        /* æ·»åŠ ä¸‹æ‹‰æ¡†æ ·å¼ */
        select {
            background-image: none;
        }
        
        select option {
            padding: 8px;
            background-color: white;
        }
        
        select:focus option:checked {
            background-color: #e6f7ff;
        }

        /* æ’­æ”¾é¡µé¢æ ·å¼ */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .video-container.landscape {
            aspect-ratio: 16/9;
            max-width: 1200px;
        }

        .video-container.portrait {
            aspect-ratio: 9/16;
            max-width: 400px;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .nav-back {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-back:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .platform-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
        }

        .platform-bilibili {
            background: linear-gradient(45deg, #00a1d6, #fb7299);
        }

        .platform-douyin {
            background: linear-gradient(45deg, #ff0050, #ff4081);
        }

        .platform-youtube {
            background: linear-gradient(45deg, #ff0000, #ff4444);
        }

        .platform-twitter {
            background: linear-gradient(45deg, #1da1f2, #1a91da);
        }

        .platform-xiaohongshu {
            background: linear-gradient(45deg, #ff2442, #ff6b7a);
        }

        .platform-netease {
            background: linear-gradient(45deg, #c20c0c, #e63d3d);
        }

        .platform-qqmusic {
            background: linear-gradient(45deg, #31c27c, #5bd67a);
        }

        .platform-instagram {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
        }

        .platform-kuaishou {
            background: linear-gradient(45deg, #ff4906, #ff6b32);
        }

        .platform-tiktok {
            background: linear-gradient(45deg, #000000, #ff0050, #00f2ea);
        }

        .platform-weibo {
            background: linear-gradient(45deg, #e6162d, #ff8200);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .video-container {
                border-radius: 8px;
            }
            
            .nav-back {
                width: 40px;
                height: 40px;
                top: 16px;
                left: 16px;
            }
        }

        /* éšè—æ’­æ”¾é¡µé¢ */
        .play-page {
            display: none;
        }

        .play-page.active {
            display: block;
        }

        /* éšè—åˆ—è¡¨é¡µé¢ */
        .list-page.hidden {
            display: none;
        }

        /* Twitterè§†é¢‘ç­›é€‰æ ·å¼ - ä»…åœ¨ç­›é€‰Twitteræ—¶ä½¿ç”¨ */
        .twitter-filter-active .video-card:not([data-platform="twitter"]) {
            display: none;
        }

        /* æœ¬åœ°ä¸‹è½½é¡µé¢æ ·å¼ */
        .local-download-page {
            display: none;
            min-height: 100vh;
            background: #f9f9f9;
            padding: 2rem 1rem;
        }

        .local-download-page.active {
            display: block;
        }

        .local-download-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .local-download-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        .parse-result-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
        }

        .parse-result-cover {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
        }

        .parse-result-info {
            padding: 1.5rem;
        }

        .parse-result-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }

        .parse-result-meta {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .parse-result-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn-download {
            flex: 1;
            min-width: 150px;
            padding: 0.75rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-download:hover {
            background: #2563eb;
        }

        .btn-copy {
            flex: 1;
            min-width: 150px;
            padding: 0.75rem 1.5rem;
            background: white;
            color: #3b82f6;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-copy:hover {
            background: #3b82f6;
            color: white;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            color: #92400e;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            color: #1e40af;
        }

        @media (max-width: 640px) {
            .local-download-card {
                padding: 1.5rem;
            }

            .parse-result-actions {
                flex-direction: column;
            }

            .btn-download,
            .btn-copy {
                min-width: 100%;
            }
        }

        /* å¤šè§†é¢‘åˆ—è¡¨æ ·å¼ */
        .multi-video-list {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .video-item-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            border: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .video-item-card:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .video-item-card.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .video-item-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .video-item-index {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .video-item-title {
            flex: 1;
            font-weight: 500;
            font-size: 0.875rem;
            color: #1f2937;
            line-height: 1.4;
        }

        .video-item-meta {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .batch-download-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .batch-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .select-all-btn {
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-all-btn:hover {
            background: #2563eb;
        }

        .selected-count {
            padding: 0.5rem 1rem;
            background: #eff6ff;
            color: #3b82f6;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* å›¾ç‰‡åˆ—è¡¨æ ·å¼ */
        .image-list-container {
            margin-top: 1rem;
        }

        .image-list-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }

        .image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .image-item:hover {
            transform: scale(1.05);
        }

        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-index {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- éšè—å¹³å°é…ç½® -->
    <input type="hidden" id="hiddenPlatformsConfig" th:value="${hiddenplatforms != null ? hiddenplatforms : ''}" />
    <!-- è§†é¢‘åˆ—è¡¨é¡µé¢ -->
    <div id="listPage" class="list-page">
        <!-- å¯¼èˆªæ  -->
        <nav class="bg-white shadow-lg p-4 nav-container">
            <div class="container mx-auto">
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <h1 id="mainTitle" class="hidden sm:block text-2xl font-bold text-blue-600">æ— åå°ç«™</h1>
                    
                    <!-- æœç´¢å’Œå¹³å°é€‰æ‹© -->
                    <div class="w-full flex-1 flex items-center gap-1 sm:gap-2">
                        <div class="flex-1 flex items-center bg-white rounded-full border border-gray-300 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500 transition-all duration-200">
                            <input type="search" 
                                   id="searchInput"
                                   placeholder="æœç´¢..." 
                                   class="flex-1 px-2 sm:px-4 py-2 text-sm bg-transparent border-none focus:outline-none focus:ring-0">
                            <div class="h-6 w-px bg-gray-300"></div>
                            <div class="relative flex-shrink-0">
                                <select id="platformSelect" 
                                        class="pl-2 sm:pl-4 pr-6 sm:pr-8 py-2 text-sm bg-transparent border-none focus:outline-none focus:ring-0 appearance-none cursor-pointer">
                                    <option value="">å…¨éƒ¨</option>
                                    <option value="æŠ–éŸ³">æŠ–éŸ³</option>
                                    <option value="å“”å“©">å“”å“©å“”å“©</option>
                                    <option value="Instagram">Instagram</option>
                                    <option value="å¿«æ‰‹">å¿«æ‰‹</option>
                                    <option value="TikTok">TikTok</option>
                                    <option value="twitter">Twitter</option>
                                    <option value="å¾®åš">å¾®åš</option>
                                    <option value="å°çº¢ä¹¦">å°çº¢ä¹¦</option>
                                    <option value="youtube">YouTube</option>
                                </select>
                                <div class="absolute right-1 sm:right-2 top-1/2 -translate-y-1/2 pointer-events-none">
                                    <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </div>
                            </div>
                            <button id="resetFilterBtn" 
                                    class="p-1.5 sm:p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors duration-200 ml-1 hidden">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="flex items-center gap-1 sm:gap-2">
                            <button th:if="${video_pure != 'y'}" onclick="openSubmitModal()" 
                                    class="p-1.5 sm:p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors duration-200">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                            </button>
                            <button th:if="${video_pure != 'y'}" onclick="showLocalDownloadPage()" 
                                    class="p-1.5 sm:p-2 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors duration-200"
                                    title="æœ¬åœ°ä¸‹è½½">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                            </button>
                            <button onclick="openSettings()" 
                                    class="p-1.5 sm:p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors duration-200">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- è®¾ç½®æ¨¡æ€æ¡† -->
        <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100]">
            <div class="bg-white rounded-lg w-full max-w-lg relative z-[101]">
                <div class="p-4 border-b">
                    <h2 class="text-xl font-bold">è®¾ç½®</h2>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">ç½‘ç«™æ ‡é¢˜</label>
                        <input type="text" id="siteTitle" class="w-full px-3 py-2 border rounded" placeholder="è¯·è¾“å…¥ç½‘ç«™æ ‡é¢˜">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Token</label>
                        <input type="text" id="serverToken" class="w-full px-3 py-2 border rounded" placeholder="è¯·è¾“å…¥Token">
                    </div>
                </div>
                <div class="p-4 border-t flex justify-end space-x-2">
                    <button onclick="closeSettingsModal()" class="px-4 py-2 border rounded">å–æ¶ˆ</button>
                    <button onclick="saveSettings()" class="px-4 py-2 bg-blue-500 text-white rounded">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- æäº¤é“¾æ¥å¼¹çª— -->
        <div id="submitModal" th:if="${video_pure != 'y'}" class="modal">
            <div class="modal-content m-auto bg-white p-6 w-96">
                <h2 class="text-xl font-bold mb-4">æäº¤è§†é¢‘é“¾æ¥</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">è§†é¢‘é“¾æ¥æˆ–åˆ†äº«å£ä»¤</label>
                        <input type="text" id="videoUrl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="è¯·è¾“å…¥è§†é¢‘é“¾æ¥æˆ–åˆ†äº«å£ä»¤">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeSubmitModal()" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">å–æ¶ˆ</button>
                        <button onclick="submitVideo()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">æäº¤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¡®è®¤æäº¤å¼¹çª— -->
        <div id="confirmModal" class="modal">
            <div class="modal-content m-auto bg-white p-6 w-96">
                <h2 class="text-xl font-bold mb-4">æ£€æµ‹åˆ°è§†é¢‘é“¾æ¥</h2>
                <div class="space-y-4">
                    <p class="text-gray-600 break-all" id="clipboardContent"></p>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeConfirmModal()" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">å–æ¶ˆ</button>
                        <button onclick="confirmSubmit()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">æäº¤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div class="container mx-auto py-4 sm:py-8">
            <!-- æœåŠ¡å™¨æœªé…ç½®æç¤º -->
            <div id="configError" class="hidden">
                <div class="flex flex-col items-center justify-center p-8 bg-white rounded-lg shadow-sm">
                    <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-900 mb-2">æœªé…ç½®Token</h2>
                    <p class="text-gray-600 text-center mb-4">è¯·å…ˆé…ç½®Token</p>
                    <button onclick="openSettings()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        å‰å¾€è®¾ç½®
                    </button>
                </div>
            </div>

            <!-- æ•°æ®ä¸ºç©ºæç¤º -->
            <div id="emptyState" class="hidden">
                <div class="flex flex-col items-center justify-center p-8 bg-white rounded-lg shadow-sm">
                    <svg class="w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-900 mb-2">æš‚æ— è§†é¢‘</h2>
                    <p class="text-gray-600 text-center">å½“å‰æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è§†é¢‘</p>
                </div>
            </div>

            <!-- éª¨æ¶å± -->
            <div id="skeletonLoader" class="video-grid">
                <!-- éª¨æ¶å±é¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div id="videoList" class="video-grid hidden">
                <!-- è§†é¢‘å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            
            <!-- åŠ è½½åŠ¨ç”»ä¼˜åŒ– -->
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner"></div>
                <p class="mt-2 text-sm text-gray-600">åŠ è½½ä¸­...</p>
            </div>

            <!-- åˆ†é¡µæ§ä»¶ -->
            <div id="paginationContainer" class="pagination-container hidden">
                <div class="flex items-center justify-center gap-2 flex-wrap">
                    <button id="prevPageBtn" onclick="goToPrevPage()" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <span class="flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                            ä¸Šä¸€é¡µ
                        </span>
                    </button>
                    <div class="flex items-center gap-1" id="pageNumbers">
                        <!-- é¡µç æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button id="nextPageBtn" onclick="goToNextPage()" 
                            class="px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <span class="flex items-center gap-1">
                            ä¸‹ä¸€é¡µ
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </button>
                </div>
                <div class="text-center mt-3 text-sm text-gray-500">
                    <span>ç¬¬ <span id="currentPageNum">1</span> é¡µï¼Œå…± <span id="totalPagesNum">1</span> é¡µï¼ˆå…± <span id="totalItemsNum">0</span> æ¡ï¼‰</span>
                </div>
            </div>
        </div>

        <!-- å…è´£å£°æ˜ -->
        <footer class="bg-white shadow-lg p-4 mt-8">
            <div class="container mx-auto text-center text-gray-500 text-sm max-w-5xl">
                <p class="whitespace-normal">å…è´£å£°æ˜ï¼šæœ¬ç«™ä»…ä½œä¸ºå±•ç¤ºå¹³å°ï¼Œä¸å­˜å‚¨ã€ä¸å¤„ç†ä»»ä½•æ•°æ®ï¼Œä¸æä¾›ä»»ä½•è§£æã€ä¸‹è½½ã€è½¬ç ç­‰æœåŠ¡ã€‚æ‰€æœ‰èµ„æºå‡æ¥è‡ªç¬¬ä¸‰æ–¹å¹³å°ï¼Œæœ¬ç«™ä¸å¯¹å…¶å†…å®¹è´Ÿè´£ã€‚ç”¨æˆ·åº”éµå®ˆå½“åœ°ç›¸å…³æ³•å¾‹æ³•è§„ï¼Œåˆç†ä½¿ç”¨æœ¬ç«™æœåŠ¡ã€‚</p>
                <p class="mt-2">Â© 2025 <span id="footerTitle">xxx</span> - ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨</p>
            </div>
        </footer>
    </div>

    <!-- è§†é¢‘æ’­æ”¾é¡µé¢ -->
    <div id="playPage" class="play-page">
        <div class="min-h-screen bg-gray-100 p-4">
            <div class="container mx-auto max-w-6xl">
                <!-- è§†é¢‘æ’­æ”¾å™¨ -->
                <div class="video-container mb-6">
                    <video id="videoFrame" controls preload="metadata" class="w-full h-full">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                    </video>
                </div>
                
                <!-- è§†é¢‘ä¿¡æ¯ -->
                <div class="bg-white rounded-lg shadow-sm p-4 sm:p-6">
                    <div class="space-y-4">
                        <!-- è§†é¢‘æ ‡é¢˜å’Œå¹³å°ä¿¡æ¯ -->
                        <div>
                            <h1 id="videoTitle" class="text-lg font-semibold text-gray-900 mb-3 line-clamp-2"></h1>
                            <div class="flex items-center gap-3 text-sm text-gray-600">
                                <span id="platformTag" class="platform-tag"></span>
                                <span id="createTime" class=""></span>
                            </div>
                        </div>

                        <!-- è§†é¢‘ç®€ä»‹ -->
                        <div class="pt-3 border-t border-gray-100">
                            <h2 class="text-sm font-medium text-gray-700 mb-2">è§†é¢‘ç®€ä»‹</h2>
                            <p id="videoDesc" class="text-sm text-gray-600 leading-relaxed whitespace-pre-wrap break-all"></p>
                        </div>
                    </div>
                </div>
                
                <!-- è¿”å›æŒ‰é’® -->
                <div class="nav-back" onclick="showListPage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- æœ¬åœ°ä¸‹è½½é¡µé¢ -->
    <div id="localDownloadPage" th:if="${video_pure != 'y'}" class="local-download-page">
        <div class="local-download-container">
            <!-- è¿”å›æŒ‰é’® -->
            <div class="nav-back" onclick="showListPageFromLocal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </div>

            <!-- ä¸»å¡ç‰‡ -->
            <div class="local-download-card">
                <!-- æ ‡é¢˜åŒºåŸŸ -->
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-500 rounded-full mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="ä¸‹è½½å›¾æ ‡">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">æœ¬åœ°ä¸‹è½½</h1>
                    <p class="text-gray-500">è§£æè§†é¢‘/éŸ³é¢‘é“¾æ¥ï¼Œç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°ç”µè„‘</p>
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <span class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" role="img" aria-label="é“¾æ¥å›¾æ ‡">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            è§†é¢‘/éŸ³é¢‘é“¾æ¥
                        </span>
                    </label>
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            id="localVideoUrl" 
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="ç²˜è´´è§†é¢‘æˆ–éŸ³é¢‘é“¾æ¥..."
                        />
                        <button 
                            onclick="parseVideoForLocal()" 
                            class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" role="img" aria-label="æœç´¢å›¾æ ‡">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            è§£æ
                        </button>
                    </div>
                </div>


                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div class="info-box">
                    <h3 class="font-semibold mb-3 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" role="img" aria-label="è¯´æ˜å›¾æ ‡">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4"></path>
                            <path d="M12 8h.01"></path>
                        </svg>
                        ä½¿ç”¨è¯´æ˜
                    </h3>
                    <ul class="text-sm space-y-2">
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-0.5">â€¢</span>
                            <span><strong>ä¸‹è½½æ–¹å¼ï¼š</strong>è§£æåå¯ç›´æ¥ä¸‹è½½è§†é¢‘/éŸ³é¢‘åˆ°æœ¬åœ°ç”µè„‘</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-0.5">â€¢</span>
                            <span><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>éƒ¨åˆ†å¹³å°éœ€è¦é…ç½®Cookieï¼ŒDASHæ ¼å¼è¯·ä½¿ç”¨æäº¤é“¾æ¥åŠŸèƒ½</span>
                        </li>
                    </ul>
                </div>

                <!-- æç¤ºå¡ç‰‡ -->
                <div class="mt-4 p-4 bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-lg">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">ğŸ’¡</span>
                        <div>
                            <h4 class="font-semibold text-amber-800 mb-1">æ³¨æ„</h4>
                            <p class="text-sm text-amber-700">è¯¥åŠŸèƒ½è¯·è‡ªæµ‹,æ— æ³•å¤„ç†issueé—®é¢˜</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è§£æç»“æœåŒºåŸŸ -->
            <div id="parseResult" style="display: none;">
                <!-- å•è§†é¢‘æ˜¾ç¤º -->
                <div id="singleVideoResult" class="parse-result-card">
                    <img id="resultCover" src="" alt="è§†é¢‘å°é¢" class="parse-result-cover" referrerpolicy="no-referrer" />
                    <div class="parse-result-info">
                        <div class="parse-result-title" id="resultTitle"></div>
                        <div class="parse-result-meta">
                            <span id="resultPlatform" class="platform-tag"></span>
                            <span class="ml-3" id="resultAuthor"></span>
                        </div>
                        
                        <!-- è­¦å‘Šä¿¡æ¯ -->
                        <div id="dashWarning" class="warning-box" style="display: none;">
                            <strong>âš ï¸ æ³¨æ„ï¼š</strong> è¯¥è§†é¢‘ä¸ºDASHæ ¼å¼ï¼ˆéŸ³è§†é¢‘åˆ†ç¦»ï¼‰
                        </div>
                        
                        <!-- å›¾ç‰‡åˆ—è¡¨å®¹å™¨ -->
                        <div id="imageListContainer" class="image-list-container" style="display: none;">
                            <div class="image-list-title">å›¾ç‰‡åˆ—è¡¨ (<span id="imageCount">0</span> å¼ )</div>
                            <div id="imageList" class="image-list"></div>
                        </div>
                        
                        <br/>
                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="parse-result-actions">
                            <button onclick="downloadToLocal()" class="btn-download">
                                <span>ğŸ“¥ ä¸‹è½½åˆ°æœ¬åœ°</span>
                            </button>
                            <button onclick="copyVideoUrl()" class="btn-copy">
                                <span>ğŸ“‹ å¤åˆ¶é“¾æ¥</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å¤šè§†é¢‘æ˜¾ç¤º -->
                <div id="multiVideoResult" class="parse-result-card" style="display: none;">
                    <div class="parse-result-info">
                        <div class="parse-result-title">
                            æ£€æµ‹åˆ°å¤šä¸ªè§†é¢‘ (å…± <span id="totalVideoCount">0</span> ä¸ª)
                        </div>
                        <div class="parse-result-meta" style="margin-bottom: 1rem;">
                            <span id="multiPlatform" class="platform-tag"></span>
                            <span class="ml-3">è¯·é€‰æ‹©è¦ä¸‹è½½çš„è§†é¢‘</span>
                        </div>
                        
                        <!-- è§†é¢‘åˆ—è¡¨ -->
                        <div id="videoListContainer" class="multi-video-list">
                            <!-- åŠ¨æ€ç”Ÿæˆè§†é¢‘é¡¹ -->
                        </div>
                        
                        <!-- æ‰¹é‡æ“ä½œ -->
                        <div class="batch-download-section">
                            <div class="batch-actions">
                                <button onclick="toggleSelectAll()" class="select-all-btn" id="selectAllBtn">
                                    å…¨é€‰
                                </button>
                                <div class="selected-count">
                                    <span>å·²é€‰æ‹©:</span>
                                    <strong id="selectedCount">0</strong>
                                    <span>/ <span id="totalCount">0</span></span>
                                </div>
                            </div>
                            
                            <div class="parse-result-actions" style="margin-top: 1rem;">
                                <button onclick="downloadSelectedVideos()" class="btn-download">
                                    <span>ğŸ“¥ ä¸‹è½½é€‰ä¸­è§†é¢‘</span>
                                </button>
                                <button onclick="copySelectedUrls()" class="btn-copy">
                                    <span>ğŸ“‹ å¤åˆ¶é€‰ä¸­é“¾æ¥</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // å…¨å±€å˜é‡
        let currentPage = 1;
        let totalPages = 1;
        let totalItems = 0;
        let isLoading = false;
        let currentSearch = '';
        let currentPlatform = '';
        let currentVideoId = null;
        let serverToken = null;
        const videoPure = /*[[${video_pure}]]*/ 'n';
        const PAGE_SIZE = 18; // æ¯é¡µæ˜¾ç¤º18ä¸ªè§†é¢‘
        
        // å¤šè§†é¢‘æ”¯æŒ
        let currentMultiVideos = []; // å­˜å‚¨å¤šè§†é¢‘åˆ—è¡¨
        let selectedVideoIndices = new Set(); // å­˜å‚¨é€‰ä¸­çš„è§†é¢‘ç´¢å¼•
        const MULTI_DOWNLOAD_DELAY_MS = 500; // æ‰¹é‡ä¸‹è½½æ—¶æ¯ä¸ªè§†é¢‘ä¹‹é—´çš„å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰

        
        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            setupEventListeners(); // è¿™é‡Œä¼šåˆå§‹åŒ–é‡ç½®æŒ‰é’®çŠ¶æ€
            loadVideoList();
            
            // ç›‘å¬å‰ªè´´æ¿å˜åŒ–
            setupClipboardListener();
            
            // æ˜¾ç¤ºå¹³å°æ ‡ç­¾ç­›é€‰æç¤º
            setTimeout(() => {
                showMessage('æç¤ºï¼šç‚¹å‡»è§†é¢‘å¡ç‰‡ä¸Šçš„å¹³å°æ ‡ç­¾å¯ç­›é€‰ç›¸åŒå¹³å°çš„è§†é¢‘');
            }, 2000);
            
            // ä»URLå‚æ•°ä¸­æ¢å¤ç­›é€‰çŠ¶æ€
            restoreFilterFromUrl();
        });
        
        // ä»URLå‚æ•°ä¸­æ¢å¤ç­›é€‰çŠ¶æ€
        function restoreFilterFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const platformParam = urlParams.get('platform');
            const searchParam = urlParams.get('search');
            
            // æ¢å¤å¹³å°ç­›é€‰
            if (platformParam) {
                filterByPlatform(platformParam);
            }
            
            // æ¢å¤æœç´¢ç­›é€‰
            if (searchParam) {
                const searchInput = document.getElementById('searchInput');
                searchInput.value = searchParam;
                currentSearch = searchParam;
                updateResetFilterButton();
                resetAndLoad();
            }
        }
        
        // é¡µé¢å¤§å°è°ƒæ•´
        window.addEventListener('resize', debounce(() => {
            adjustVideoContainer();
        }, 250));
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedTitle = localStorage.getItem('siteTitle');
            if (savedTitle) {
                document.getElementById('mainTitle').textContent = savedTitle;
                document.getElementById('footerTitle').textContent = savedTitle;
                document.title = savedTitle;
            }
            
            // åŠ è½½Tokené…ç½®
            const savedToken = localStorage.getItem('serverToken');
            if (savedToken) {
                serverToken = savedToken;
            }
        }
        

        
        // è®¾ç½®ä¿å­˜
        function saveSettings() {
            const siteTitle = document.getElementById('siteTitle').value;
            const token = document.getElementById('serverToken').value;
            
            if (siteTitle) {
                localStorage.setItem('siteTitle', siteTitle);
                document.getElementById('mainTitle').textContent = siteTitle;
                document.getElementById('footerTitle').textContent = siteTitle;
                document.title = siteTitle;
            }
            
            if (token) {
                localStorage.setItem('serverToken', token);
                serverToken = token;
            }
            
            closeSettingsModal();
            showMessage('è®¾ç½®å·²ä¿å­˜');
            
            // é‡æ–°åŠ è½½è§†é¢‘åˆ—è¡¨
            currentPage = 1;
            totalPages = 1;
            totalItems = 0;
            loadVideoList();
        }
        
        // äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
        function setupEventListeners() {
            // æœç´¢è¾“å…¥
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(() => {
                currentSearch = searchInput.value.trim();
                updateResetFilterButton();
                resetAndLoad();
            }, 500));
            
            // å¹³å°é€‰æ‹©
            const platformSelect = document.getElementById('platformSelect');
            platformSelect.addEventListener('change', () => {
                currentPlatform = platformSelect.value;
                updateResetFilterButton();
                resetAndLoad();
            });
            
            // é‡ç½®ç­›é€‰æŒ‰é’®
            const resetFilterBtn = document.getElementById('resetFilterBtn');
            resetFilterBtn.addEventListener('click', () => {
                // é‡ç½®æœç´¢å’Œå¹³å°ç­›é€‰
                searchInput.value = '';
                currentSearch = '';
                platformSelect.selectedIndex = 0;
                currentPlatform = '';
                
                // éšè—é‡ç½®æŒ‰é’®
                resetFilterBtn.classList.add('hidden');
                
                // é‡æ–°åŠ è½½è§†é¢‘åˆ—è¡¨
                resetAndLoad();
                
                // æ˜¾ç¤ºæç¤º
                showMessage('å·²é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶');
            });
            
            // åˆå§‹åŒ–é‡ç½®æŒ‰é’®çŠ¶æ€
            updateResetFilterButton();
        }
        
        // æ›´æ–°é‡ç½®ç­›é€‰æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        function updateResetFilterButton() {
            const resetFilterBtn = document.getElementById('resetFilterBtn');
            if (currentSearch || currentPlatform) {
                resetFilterBtn.classList.remove('hidden');
                // æ›´æ–°URLå‚æ•°
                updateUrlParams();
            } else {
                resetFilterBtn.classList.add('hidden');
                // æ¸…é™¤URLå‚æ•°
                clearUrlParams();
            }
            
            // å¤„ç†Twitterç­›é€‰çš„ç‰¹æ®Šæƒ…å†µ
            const listPage = document.getElementById('listPage');
            if (currentPlatform === 'twitter') {
                listPage.classList.add('twitter-filter-active');
            } else {
                listPage.classList.remove('twitter-filter-active');
            }
        }
        
        // æ›´æ–°URLå‚æ•°
        function updateUrlParams() {
            const urlParams = new URLSearchParams();
            
            if (currentPlatform) {
                urlParams.set('platform', currentPlatform);
            }
            
            if (currentSearch) {
                urlParams.set('search', currentSearch);
            }
            
            // æ›´æ–°URLï¼Œä¸åˆ·æ–°é¡µé¢
            const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
            window.history.replaceState({}, '', newUrl);
        }
        
        // æ¸…é™¤URLå‚æ•°
        function clearUrlParams() {
            window.history.replaceState({}, '', window.location.pathname);
        }
        
        // é€šè¿‡å¹³å°æ ‡ç­¾ç­›é€‰è§†é¢‘
        function filterByPlatform(platform) {
            console.log('ç­›é€‰å¹³å°:', platform);
            // æ›´æ–°å¹³å°é€‰æ‹©ä¸‹æ‹‰æ¡†
            const platformSelect = document.getElementById('platformSelect');
            
            if (platform && platform.trim() !== '') {
                // æŸ¥æ‰¾åŒ¹é…çš„é€‰é¡¹
                let found = false;
                for (let i = 0; i < platformSelect.options.length; i++) {
                    if (platformSelect.options[i].value === platform) {
                        platformSelect.selectedIndex = i;
                        found = true;
                        break;
                    }
                }
                
                // å¦‚æœä¸‹æ‹‰æ¡†ä¸­æ²¡æœ‰åŒ¹é…çš„é€‰é¡¹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°é€‰é¡¹
                if (!found) {
                    const option = document.createElement('option');
                    option.value = platform;
                    option.textContent = platform;
                    platformSelect.appendChild(option);
                    platformSelect.value = platform;
                }
                
                // è®¾ç½®å½“å‰å¹³å°å¹¶é‡æ–°åŠ è½½
                currentPlatform = platform;
                updateResetFilterButton();
                resetAndLoad();
                
                // æ˜¾ç¤ºç­›é€‰æç¤º
                showMessage(`å·²ç­›é€‰å¹³å°: ${platform}ï¼Œç‚¹å‡»å¹³å°æ ‡ç­¾å¯ç­›é€‰ç›¸åŒå¹³å°è§†é¢‘`);
            } else {
                // é‡ç½®ä¸ºå…¨éƒ¨
                platformSelect.selectedIndex = 0; // é€‰æ‹©"å…¨éƒ¨"é€‰é¡¹
                currentPlatform = '';
                updateResetFilterButton();
                resetAndLoad();
                
                // æ˜¾ç¤ºé‡ç½®æç¤º
                showMessage('å·²é‡ç½®å¹³å°ç­›é€‰ï¼Œæ˜¾ç¤ºå…¨éƒ¨è§†é¢‘');
            }
        }
        
        // é‡ç½®å¹¶åŠ è½½
        function resetAndLoad() {
            currentPage = 1;
            totalPages = 1;
            totalItems = 0;
            document.getElementById('videoList').innerHTML = '';
            loadVideoList();
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // åˆ†é¡µåŠŸèƒ½å‡½æ•°
        function goToPage(page) {
            if (page < 1 || page > totalPages || page === currentPage || isLoading) {
                return;
            }
            currentPage = page;
            document.getElementById('videoList').innerHTML = '';
            loadVideoList();
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function goToPrevPage() {
            goToPage(currentPage - 1);
        }
        
        function goToNextPage() {
            goToPage(currentPage + 1);
        }
        
        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            // æ›´æ–°é¡µç ä¿¡æ¯
            document.getElementById('currentPageNum').textContent = currentPage;
            document.getElementById('totalPagesNum').textContent = totalPages;
            document.getElementById('totalItemsNum').textContent = totalItems;
            
            // æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            // ç”Ÿæˆé¡µç æŒ‰é’®
            renderPageNumbers();
        }
        
        // æ¸²æŸ“é¡µç æŒ‰é’®
        function renderPageNumbers() {
            const container = document.getElementById('pageNumbers');
            container.innerHTML = '';
            
            // è®¡ç®—è¦æ˜¾ç¤ºçš„é¡µç èŒƒå›´
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            // è°ƒæ•´èµ·å§‹é¡µ
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // æ˜¾ç¤ºç¬¬ä¸€é¡µ
            if (startPage > 1) {
                container.appendChild(createPageButton(1));
                if (startPage > 2) {
                    container.appendChild(createEllipsis());
                }
            }
            
            // æ˜¾ç¤ºä¸­é—´é¡µç 
            for (let i = startPage; i <= endPage; i++) {
                container.appendChild(createPageButton(i));
            }
            
            // æ˜¾ç¤ºæœ€åä¸€é¡µ
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    container.appendChild(createEllipsis());
                }
                container.appendChild(createPageButton(totalPages));
            }
        }
        
        // åˆ›å»ºé¡µç æŒ‰é’®
        function createPageButton(page) {
            const btn = document.createElement('button');
            btn.className = `page-btn ${page === currentPage ? 'active' : ''}`;
            btn.textContent = page;
            btn.onclick = () => goToPage(page);
            return btn;
        }
        
        // åˆ›å»ºçœç•¥å·
        function createEllipsis() {
            const span = document.createElement('span');
            span.className = 'page-ellipsis';
            span.textContent = '...';
            return span;
        }
        
        // æ˜¾ç¤º/éšè—åˆ†é¡µæ§ä»¶
        function showPagination() {
            const container = document.getElementById('paginationContainer');
            container.classList.remove('hidden');
        }
        
        function hidePagination() {
            const container = document.getElementById('paginationContainer');
            container.classList.add('hidden');
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
        function showLoading() {
            document.getElementById('loadingSpinner').classList.add('show');
        }
        
        function hideLoading() {
            document.getElementById('loadingSpinner').classList.remove('show');
        }
        
        // åŠ¨æ€ç”Ÿæˆéª¨æ¶å±
        function generateSkeletonItems(count = 12) {
            const skeletonLoader = document.getElementById('skeletonLoader');
            skeletonLoader.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const skeletonItem = document.createElement('div');
                skeletonItem.className = 'bg-white rounded-lg shadow-sm overflow-hidden';
                skeletonItem.innerHTML = `
                    <div class="skeleton w-full" style="padding-top: 56.25%"></div>
                    <div class="p-3 space-y-2">
                        <div class="skeleton h-4 w-3/4 rounded"></div>
                        <div class="skeleton h-3 w-1/2 rounded"></div>
                        <div class="skeleton h-3 w-2/3 rounded"></div>
                    </div>
                `;
                skeletonLoader.appendChild(skeletonItem);
            }
        }
        
        // åŠ è½½è§†é¢‘åˆ—è¡¨
        async function loadVideoList() {
            if (!serverToken) {
                hideSkeleton();
                hideEmptyState();
                hideVideoList();
                hidePagination();
                showConfigError();
                return;
            }
            
            hideConfigError();
            showSkeleton();
            hidePagination();
            isLoading = true;
            
            try {
                const response = await fetchVideos();
                
                if (response && response.data && response.data.length > 0) {
                    hideSkeleton();
                    hideEmptyState();
                    showVideoList();
                    
                    const videoListEl = document.getElementById('videoList');
                    videoListEl.innerHTML = '';
                    
                    response.data.forEach(video => {
                        const videoCard = createVideoCard(video);
                        videoListEl.appendChild(videoCard);
                    });
                    
                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    totalPages = response.totalPages || 1;
                    totalItems = response.totalElements || 0;
                    updatePagination();
                    showPagination();
                } else {
                    hideSkeleton();
                    hideVideoList();
                    hidePagination();
                    showEmptyState();
                }
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', error);
                hideSkeleton();
                hidePagination();
                showMessage('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            } finally {
                isLoading = false;
                hideLoading();
            }
        }
        
        
        // è·å–è§†é¢‘æ•°æ®
        async function fetchVideos() {
            const params = new URLSearchParams({
                pageNo: currentPage,
                pageSize: PAGE_SIZE
            });
            
            if (currentSearch) {
                params.append('videoname', currentSearch);
                params.append('videodesc', currentSearch);
            }
            
            if (currentPlatform) {
                params.append('videoplatform', currentPlatform);
            } else {
                // å¦‚æœæ²¡æœ‰é€‰æ‹©ç‰¹å®šå¹³å°ï¼Œæ ¹æ®é…ç½®æ’é™¤éšè—çš„å¹³å°
                const hiddenPlatformsConfig = document.getElementById('hiddenPlatformsConfig');
                const hiddenPlatforms = hiddenPlatformsConfig ? hiddenPlatformsConfig.value : '';
                if (hiddenPlatforms && hiddenPlatforms.trim() !== '') {
                    params.append('excludePlatform', hiddenPlatforms);
                }
            }
            
            const url = addTokenToUrl(`/api/findVideos?${params.toString()}`);

            console.log('è¯·æ±‚URL:', url);
            
            const response = await axios.get(url, {
                timeout: 10000
            });
            
            console.log('æœåŠ¡å™¨å“åº”:', response.data);
            
            // æ ¹æ®å®é™…å“åº”ç»“æ„è¿”å›æ•°æ®
            if (response.data && response.data.record && response.data.record.content) {
                console.log('å½“å‰é¡µ:', currentPage, 'æ€»é¡µæ•°:', response.data.record.totalPages);
                
                return {
                    data: response.data.record.content,
                    totalPages: response.data.record.totalPages || response.data.record.page?.totalPages || 1,
                    totalElements: response.data.record.totalElements || response.data.record.page?.totalElements || 0
                };
            }
            
            return { data: [], totalPages: 1, totalElements: 0 };
        }
        
        // ç”Ÿæˆè§†é¢‘å¡ç‰‡HTML
        /**
         * åˆ›å»ºè§†é¢‘å¡ç‰‡å…ƒç´ 
         * @param {Object} video - è§†é¢‘æ•°æ®å¯¹è±¡
         * @returns {HTMLElement} è§†é¢‘å¡ç‰‡DOMå…ƒç´ 
         */
        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card bg-white rounded-lg shadow-sm overflow-hidden';
            
            // é€‚é…å®é™…å“åº”æ•°æ®å­—æ®µ
            const title = video.videoname || video.title || 'æœªçŸ¥æ ‡é¢˜';
            const cover = video.videocover || video.cover;
            const platform = video.videoplatform || video.platform || 'æœªçŸ¥å¹³å°';
            const createTime = video.createtime || video.createTime;
            const videoAddr = video.videounrealaddr || video.videoAddr || '';
            
            // å°†è§†é¢‘æ’­æ”¾åœ°å€è¿›è¡Œbase64ç¼–ç å­˜å‚¨åœ¨dataå±æ€§ä¸­ï¼Œé¿å…ç‰¹æ®Šç¬¦å·é—®é¢˜
            const encodedVideoAddr = btoa(encodeURIComponent(videoAddr));
            card.setAttribute('data-video-id', video.id);
            card.setAttribute('data-video-addr', encodedVideoAddr);
            card.setAttribute('data-video-title', btoa(encodeURIComponent(title)));
            card.setAttribute('data-video-desc', btoa(encodeURIComponent(video.videodesc || video.description || '')));
            card.setAttribute('data-video-platform', btoa(encodeURIComponent(platform)));
            card.setAttribute('data-create-time', createTime || '');
            
            // æ·»åŠ å¹³å°æ ‡è¯†ç”¨äºç­›é€‰ï¼ˆç”¨äºå‰ç«¯å¹³å°ç­›é€‰åŠŸèƒ½ï¼‰
            const platformLower = platform.toLowerCase();
            if (platformLower.includes('twitter')) {
                card.setAttribute('data-platform', 'twitter');
            }
            
            // ç‚¹å‡»äº‹ä»¶ä½¿ç”¨dataå±æ€§ä¸­çš„ä¿¡æ¯
            card.onclick = () => playVideoFromCard(card);
            
            const platformClass = getPlatformClass(platform);
            const formattedDate = formatDate(createTime);
            
            // æ‹¼æ¥ç¼©ç•¥å›¾è·¯å¾„ï¼Œæ·»åŠ tokenå‚æ•°
			const coverUrl = addAppTokenToUrl(cover);
            card.innerHTML = `
                <div class="video-thumbnail">
                    <img src="${coverUrl}" 
                         alt="${title}" 
                         loading="lazy">
                    <div class="video-platform-tag ${platformClass} cursor-pointer" data-platform="${platform}">
                        ${platform}
                    </div>
                    <div class="play-button">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                </div>
                <div class="p-3">
                    <h3 class="font-medium text-gray-900 line-clamp-2 mb-2">${title}</h3>
                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <span class="${platformClass} text-white px-2 py-1 rounded text-xs cursor-pointer hover:shadow-md transition-all" data-platform="${platform}">
                            ${platform}
                        </span>
                        <span>${formattedDate}</span>
                    </div>
                </div>
            `;
            
            // ä¸ºå¹³å°æ ‡ç­¾æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const platformTags = card.querySelectorAll('[data-platform]');
            platformTags.forEach(tag => {
                tag.addEventListener('click', (event) => {
                    event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶
                    const platform = event.target.getAttribute('data-platform');
                    filterByPlatform(platform);
                });
            });
            
            return card;
        }
        
        // è·å–å¹³å°æ ·å¼ç±»
        function getPlatformClass(platform) {
            const platformLower = platform.toLowerCase();
            if (platformLower.includes('å“”å“©') || platformLower.includes('bilibili')) {
                return 'platform-bilibili';
            } else if (platformLower.includes('æŠ–éŸ³') || platformLower.includes('douyin')) {
                return 'platform-douyin';
            } else if (platformLower.includes('youtube')) {
                return 'platform-youtube';
            } else if (platformLower.includes('twitter')) {
                return 'platform-twitter';
            } else if (platformLower.includes('å°çº¢ä¹¦') || platformLower.includes('xiaohongshu')) {
                return 'platform-xiaohongshu';
            } else if (platformLower.includes('ç½‘æ˜“') || platformLower.includes('netease')) {
                return 'platform-netease';
            } else if (platformLower.includes('qqéŸ³ä¹') || platformLower.includes('qqmusic')) {
                return 'platform-qqmusic';
            } else if (platformLower.includes('instagram')) {
                return 'platform-instagram';
            } else if (platformLower.includes('å¿«æ‰‹') || platformLower.includes('kuaishou')) {
                return 'platform-kuaishou';
            } else if (platformLower.includes('tiktok')) {
                return 'platform-tiktok';
            } else if (platformLower.includes('å¾®åš') || platformLower.includes('weibo')) {
                return 'platform-weibo';
            }
            return 'bg-gray-500';
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 60) {
                return `${minutes}åˆ†é’Ÿå‰`;
            } else if (hours < 24) {
                return `${hours}å°æ—¶å‰`;
            } else if (days < 30) {
                return `${days}å¤©å‰`;
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }
        
        // URLæ·»åŠ token
        function addTokenToUrl(url) {
            if (serverToken) {
                const separator = url.includes('?') ? '&' : '?';
                return `${url}${separator}token=${encodeURIComponent(serverToken)}`;
            }
            return url;
        }

        // URLæ·»åŠ apptokenï¼ˆç”¨äºç¼©ç•¥å›¾å’Œè§†é¢‘åœ°å€ï¼‰
        function addAppTokenToUrl(url) {
            if (serverToken) {
                const separator = url.includes('?') ? '&' : '?';
                return `${url}${separator}apptoken=${encodeURIComponent(serverToken)}`;
            }
            return url;
        }
        // è®¾ç½®å¼¹çª—
        function openSettings() {
            document.getElementById('siteTitle').value = localStorage.getItem('siteTitle') || '';
            document.getElementById('settingsModal').classList.remove('hidden');
        }
        
        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        
        // æ¶ˆæ¯æç¤º
        function showMessage(message, type = 'success') {
            // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
            const messageEl = document.createElement('div');
            messageEl.className = `fixed top-4 right-4 px-4 py-2 rounded-md text-white z-50 transition-all duration-300 ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            }`;
            messageEl.textContent = message;
            
            document.body.appendChild(messageEl);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageEl.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
        }
        
        // æ˜¾ç¤º/éšè—å„ç§çŠ¶æ€
        function showConfigError() {
            document.getElementById('configError').classList.remove('hidden');
        }
        
        function hideConfigError() {
            document.getElementById('configError').classList.add('hidden');
        }
        
        function showEmptyState() {
            document.getElementById('emptyState').classList.remove('hidden');
        }
        
        function hideEmptyState() {
            document.getElementById('emptyState').classList.add('hidden');
        }
        
        function showSkeleton() {
            generateSkeletonItems(12);
            document.getElementById('skeletonLoader').classList.remove('hidden');
        }
        
        function hideSkeleton() {
            document.getElementById('skeletonLoader').classList.add('hidden');
        }
        
        function showVideoList() {
            document.getElementById('videoList').classList.remove('hidden');
        }
        
        function hideVideoList() {
            document.getElementById('videoList').classList.add('hidden');
        }
        
        // è·å–æœåŠ¡å™¨é…ç½®ï¼ˆå·²åºŸå¼ƒï¼Œä¿ç•™å…¼å®¹æ€§ï¼‰
        function getServerConfig() {
            return { token: serverToken };
        }
        
        // å‰ªè´´æ¿ç›‘å¬
        function setupClipboardListener() {
            let lastClipboardContent = '';
            
            // å®šæœŸæ£€æŸ¥å‰ªè´´æ¿å†…å®¹
            setInterval(async () => {
                try {
                    if (navigator.clipboard && navigator.clipboard.readText) {
                        const clipboardText = await navigator.clipboard.readText();
                        
                        if (clipboardText !== lastClipboardContent && isVideoUrl(clipboardText)) {
                            lastClipboardContent = clipboardText;
                            showConfirmModal(clipboardText);
                        }
                    }
                } catch (error) {
                    // å¿½ç•¥å‰ªè´´æ¿è®¿é—®é”™è¯¯
                }
            }, 2000);
        }
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘URL
        function isVideoUrl(text) {
            const videoPatterns = [
                /bilibili\.com/,
                /douyin\.com/,
                /youtube\.com/,
                /youtu\.be/,
                /twitter\.com/,
                /instagram\.com/,
                /æŠ–éŸ³/,
                /å¤åˆ¶è¿™æ¡ä¿¡æ¯/
            ];
            
            return videoPatterns.some(pattern => pattern.test(text));
        }
        
        // ç¡®è®¤å¼¹çª—
        function showConfirmModal(content) {
            document.getElementById('clipboardContent').textContent = content;
            document.getElementById('confirmModal').classList.add('show');
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }
        
        function confirmSubmit() {
            const content = document.getElementById('clipboardContent').textContent;
            submitVideoUrl(content);
            closeConfirmModal();
        }
        
        // è§†é¢‘æäº¤å¼¹çª—
        function openSubmitModal() {
            if (videoPure === 'y') {
                return;
            }
            document.getElementById('submitModal').classList.add('show');
        }
        
        function closeSubmitModal() {
            document.getElementById('submitModal').classList.remove('show');
            document.getElementById('videoUrl').value = '';
        }
        
        function submitVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            if (url) {
                submitVideoUrl(url);
                closeSubmitModal();
            }
        }
        
        // æäº¤è§†é¢‘URL
        async function submitVideoUrl(url) {
        	if (!serverToken) {
        		  showMessage('è¯·å…ˆé…ç½® Token', 'error');
        		  return;
        	}
            
            try {
            	const submitUrl = '/api/processingVideos';
                
                const formData = new URLSearchParams();
                formData.append('video', url);
                formData.append('token', serverToken);
                
                await axios.post(submitUrl, formData, {
                    timeout: 30000,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
                
                showMessage('æäº¤æˆåŠŸï¼Œæ­£åœ¨å¤„ç†ä¸­...');
                
                // å»¶è¿Ÿåˆ·æ–°åˆ—è¡¨
                setTimeout(() => {
                    resetAndLoad();
                }, 2000);
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                showMessage('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        

        
        /**
         * ä»è§†é¢‘å¡ç‰‡çš„dataå±æ€§ä¸­æ’­æ”¾è§†é¢‘
         * @param {HTMLElement} card - è§†é¢‘å¡ç‰‡DOMå…ƒç´ 
         */
        function playVideoFromCard(card) {
            if (!serverToken) {
                showMessage('è¯·å…ˆé…ç½®Token', 'error');
                return;
            }
            
            try {
                // ä»å¡ç‰‡dataå±æ€§ä¸­è§£ç è§†é¢‘ä¿¡æ¯
                const videoId = card.getAttribute('data-video-id');
                const encodedVideoAddr = card.getAttribute('data-video-addr');
                const encodedTitle = card.getAttribute('data-video-title');
                const encodedDesc = card.getAttribute('data-video-desc');
                const encodedPlatform = card.getAttribute('data-video-platform');
                const createTime = card.getAttribute('data-create-time');
                
                // base64è§£ç è§†é¢‘ä¿¡æ¯
                const videoAddr = decodeURIComponent(atob(encodedVideoAddr));
                const title = decodeURIComponent(atob(encodedTitle));
                const description = decodeURIComponent(atob(encodedDesc));
                const platform = decodeURIComponent(atob(encodedPlatform));
                
                // æ„å»ºè§†é¢‘ä¿¡æ¯å¯¹è±¡
                const videoInfo = {
                    id: videoId,
                    videounrealaddr: videoAddr,
                    videoname: title,
                    videodesc: description,
                    videoplatform: platform,
                    createtime: createTime
                };
                currentVideoId = videoId;
                
                // æ˜¾ç¤ºæ’­æ”¾é¡µé¢
                showPlayPage(videoInfo);
                
                // ä¿å­˜æ’­æ”¾å†å²
                savePlayHistory(videoInfo);
            } catch (error) {
                console.error('æ’­æ”¾è§†é¢‘å¤±è´¥:', error);
                showMessage('æ’­æ”¾è§†é¢‘å¤±è´¥', 'error');
            }
        }
        
        /**
         * æ’­æ”¾è§†é¢‘ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬è°ƒç”¨ï¼‰
         * @param {string} videoId - è§†é¢‘ID
         */
        function playVideo(videoId) {
            if (!serverToken) {
                showMessage('è¯·å…ˆé…ç½®Token', 'error');
                return;
            }
            
            currentVideoId = videoId;
            
            try {
                // æ³¨æ„ï¼šæ­¤å‡½æ•°ä¿ç•™ç”¨äºå…¼å®¹æ—§ç‰ˆæœ¬è°ƒç”¨
                // æ–°ç‰ˆæœ¬å»ºè®®ä½¿ç”¨ playVideoFromCard å‡½æ•°
                console.warn('playVideoå‡½æ•°å·²è¿‡æ—¶ï¼Œå»ºè®®ä½¿ç”¨playVideoFromCard');
                showMessage('è§†é¢‘ä¿¡æ¯è·å–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                return;
                
                // æ˜¾ç¤ºæ’­æ”¾é¡µé¢
                showPlayPage(videoInfo);
                
                // ä¿å­˜æ’­æ”¾å†å²
                savePlayHistory(videoInfo);
            } catch (error) {
                console.error('æ’­æ”¾è§†é¢‘å¤±è´¥:', error);
                showMessage('æ’­æ”¾è§†é¢‘å¤±è´¥', 'error');
            }
        }
        
        // æ˜¾ç¤ºæ’­æ”¾é¡µé¢
        function showPlayPage(videoInfo) {
            // éšè—åˆ—è¡¨é¡µé¢
            document.getElementById('listPage').classList.add('hidden');
            
            // æ˜¾ç¤ºæ’­æ”¾é¡µé¢
            const playPage = document.getElementById('playPage');
            playPage.classList.add('active');
            
            // è®¾ç½®è§†é¢‘ä¿¡æ¯
            document.getElementById('videoTitle').textContent = videoInfo.videoname || videoInfo.title;
            document.getElementById('videoDesc').textContent = videoInfo.videodesc || videoInfo.description || 'æš‚æ— ç®€ä»‹';
            document.getElementById('createTime').textContent = formatDate(videoInfo.createtime || videoInfo.createTime);
            
            // è®¾ç½®å¹³å°æ ‡ç­¾
            const platformTag = document.getElementById('platformTag');
            platformTag.textContent = videoInfo.videoplatform || videoInfo.platform;
            platformTag.className = `platform-tag ${getPlatformClass(videoInfo.videoplatform || videoInfo.platform)}`;
            
            // è®¾ç½®è§†é¢‘æ’­æ”¾å™¨
            const videoFrame = document.getElementById('videoFrame');
            // ä½¿ç”¨videounrealaddrä½œä¸ºè§†é¢‘æ’­æ”¾åœ°å€ï¼Œæ·»åŠ tokenå‚æ•°
			const videoUrl = addAppTokenToUrl(videoInfo.videounrealaddr);
            videoFrame.src = videoUrl;
            
            // æ£€æµ‹è§†é¢‘æ¯”ä¾‹å¹¶è°ƒæ•´å®¹å™¨
            videoFrame.onloadedmetadata = () => {
                adjustVideoContainer();
            };
            
            // åŠ è½½æ’­æ”¾è¿›åº¦
            loadPlayProgress();
            
            // ç›‘å¬æ’­æ”¾è¿›åº¦
            videoFrame.ontimeupdate = () => {
                savePlayProgress();
            };
            
            // è§†é¢‘ç»“æŸæ—¶æ¸…é™¤è¿›åº¦
            videoFrame.onended = () => {
                clearPlayProgress();
            };
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo(0, 0);
        }
        
        // æ˜¾ç¤ºåˆ—è¡¨é¡µé¢
        function showListPage() {
            // éšè—æ’­æ”¾é¡µé¢
            const playPage = document.getElementById('playPage');
            playPage.classList.remove('active');
            
            // æ˜¾ç¤ºåˆ—è¡¨é¡µé¢
            document.getElementById('listPage').classList.remove('hidden');
            
            // åœæ­¢è§†é¢‘æ’­æ”¾
            const videoFrame = document.getElementById('videoFrame');
            videoFrame.src = '';
            
            currentVideoId = null;
        }
        
        // æ˜¾ç¤ºæœ¬åœ°ä¸‹è½½é¡µé¢
        function showLocalDownloadPage() {
            if (videoPure === 'y') {
                return;
            }
            // éšè—åˆ—è¡¨é¡µé¢
            //åˆ¤æ–­tokenå¡«æ²¡å¡«
            if (!serverToken) {
                showMessage('è¯·å…ˆé…ç½®Token', 'error');
                return;
            }
            document.getElementById('listPage').classList.add('hidden');
            
            // æ˜¾ç¤ºæœ¬åœ°ä¸‹è½½é¡µé¢
            const localDownloadPage = document.getElementById('localDownloadPage');
            localDownloadPage.classList.add('active');
            
            // æ¸…ç©ºè¾“å…¥å’Œç»“æœ
            document.getElementById('localVideoUrl').value = '';
            document.getElementById('parseResult').style.display = 'none';
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo(0, 0);
        }
        
        // ä»æœ¬åœ°ä¸‹è½½é¡µé¢è¿”å›åˆ—è¡¨é¡µé¢
        function showListPageFromLocal() {
            // éšè—æœ¬åœ°ä¸‹è½½é¡µé¢
            const localDownloadPage = document.getElementById('localDownloadPage');
            localDownloadPage.classList.remove('active');
            
            // æ˜¾ç¤ºåˆ—è¡¨é¡µé¢
            document.getElementById('listPage').classList.remove('hidden');
        }
        
        // å…¨å±€å˜é‡å­˜å‚¨è§£æç»“æœ
        let currentParseResult = null;
        
        // è§£æè§†é¢‘ç”¨äºæœ¬åœ°ä¸‹è½½
        async function parseVideoForLocal() {
            const urlInput = document.getElementById('localVideoUrl');
            const videoUrl = urlInput.value.trim();
            
            if (!videoUrl) {
                alert('è¯·è¾“å…¥è§†é¢‘é“¾æ¥');
                return;
            }
            
            if (!serverToken) {
                alert('Tokenæœªé…ç½®ï¼Œè¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®Token');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const parseBtn = document.querySelector('button[onclick="parseVideoForLocal()"]');
            if (!parseBtn) return;
            
            const originalText = parseBtn.innerHTML;
            parseBtn.innerHTML = 'è§£æä¸­...';
            parseBtn.disabled = true;
            
            try {
                const formData = new URLSearchParams();
                formData.append('token', serverToken);
                formData.append('video', videoUrl);
                
                const response = await axios.post('/api/directData', formData, {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
                
                if (response.data.resCode === '000001') {
                    // è§£ææˆåŠŸ
                    currentParseResult = response.data.record;
                    displayParseResult(currentParseResult);
                } else {
                    alert('è§£æå¤±è´¥: ' + response.data.message);
                }
            } catch (error) {
                console.error('è§£æå¤±è´¥', error);
                alert('è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®');
            } finally {
                parseBtn.innerHTML = originalText;
                parseBtn.disabled = false;
            }
        }
        
        // æ˜¾ç¤ºè§£æç»“æœ
        function displayParseResult(result) {
            const resultDiv = document.getElementById('parseResult');
            const singleResult = document.getElementById('singleVideoResult');
            const multiResult = document.getElementById('multiVideoResult');
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå¤šè§†é¢‘ç»“æœ
            if (result.type === 'multiple' && result.videos && result.videos.length > 1) {
                // æ˜¾ç¤ºå¤šè§†é¢‘ç•Œé¢
                singleResult.style.display = 'none';
                multiResult.style.display = 'block';
                
                displayMultiVideoResult(result);
            } else {
                // æ˜¾ç¤ºå•è§†é¢‘ç•Œé¢ (åŸæœ‰é€»è¾‘)
                singleResult.style.display = 'block';
                multiResult.style.display = 'none';
                
                displaySingleVideoResult(result);
            }
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // æ˜¾ç¤ºå•è§†é¢‘ç»“æœ (åŸæœ‰é€»è¾‘)
        function displaySingleVideoResult(result) {
            const coverImg = document.getElementById('resultCover');
            const titleEl = document.getElementById('resultTitle');
            const platformEl = document.getElementById('resultPlatform');
            const authorEl = document.getElementById('resultAuthor');
            const dashWarning = document.getElementById('dashWarning');
            const imageListContainer = document.getElementById('imageListContainer');
            
            // è®¾ç½®æ ‡é¢˜ï¼ˆè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ä»¥é˜²æ­¢XSSï¼‰
            let titleText = sanitizeText(result.title || 'æœªçŸ¥æ ‡é¢˜');
            // å¦‚æœæ˜¯éŸ³é¢‘ç±»å‹ï¼Œæ·»åŠ æ ‡è¯†
            if (result.mediaType === 'audio') {
                titleText = 'ğŸµ ' + titleText;
            } else if (result.mediaType === 'image') {
                titleText = 'ğŸ–¼ï¸ ' + titleText;
            }
            titleEl.textContent = titleText;
            
            // è®¾ç½®å¹³å°æ ‡ç­¾
            platformEl.textContent = sanitizeText(result.platform || '');
            platformEl.className = 'platform-tag';
            if (result.platform === 'æŠ–éŸ³') {
                platformEl.classList.add('platform-douyin');
            } else if (result.platform === 'bilibili' || result.platform === 'BiliBili') {
                platformEl.classList.add('platform-bilibili');
            } else if (result.platform === 'youtube') {
                platformEl.classList.add('platform-youtube');
            } else if (result.platform === 'twitter') {
                platformEl.classList.add('platform-twitter');
            } else if (result.platform === 'å°çº¢ä¹¦') {
                platformEl.classList.add('platform-xiaohongshu');
            } else if (result.platform === 'ç½‘æ˜“äº‘éŸ³ä¹') {
                platformEl.classList.add('platform-netease');
            } else if (result.platform === 'QQéŸ³ä¹') {
                platformEl.classList.add('platform-qqmusic');
            }
            
            // è®¾ç½®ä½œè€…
            authorEl.textContent = result.author ? 'ä½œè€…: ' + sanitizeText(result.author) : '';
            
            // éšè—DASHè­¦å‘Š
            dashWarning.style.display = 'none';
            
            // å¤„ç†å›¾ç‰‡ç±»å‹
            if (result.mediaType === 'image' && result.imageUrls && result.imageUrls.length > 0) {
                // æ˜¾ç¤ºå›¾ç‰‡åˆ—è¡¨
                coverImg.style.display = 'none';
                imageListContainer.style.display = 'block';
                displayImageList(result.imageUrls);
            } else {
                // æ˜¾ç¤ºå•ä¸ªå°é¢å›¾
                coverImg.style.display = 'block';
                imageListContainer.style.display = 'none';
                
                // éªŒè¯å’Œæ¸…ç†å°é¢URL
                if (result.coverUrl && isValidUrl(result.coverUrl)) {
                    coverImg.src = result.coverUrl;
                } else {
                    coverImg.src = '';
                }
                
                // æ˜¾ç¤ºDASHè­¦å‘Š
                if (result.isDash) {
                    dashWarning.style.display = 'block';
                }
            }
        }
        
        // æ˜¾ç¤ºå›¾ç‰‡åˆ—è¡¨
        function displayImageList(imageUrls) {
            const imageList = document.getElementById('imageList');
            const imageCount = document.getElementById('imageCount');
            
            imageCount.textContent = imageUrls.length;
            imageList.innerHTML = '';
            
            imageUrls.forEach((url, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                const img = document.createElement('img');
                img.src = url;
                img.alt = `å›¾ç‰‡ ${index + 1}`;
                img.className = 'image-preview';
                img.referrerPolicy = 'no-referrer';
                
                const indexLabel = document.createElement('div');
                indexLabel.className = 'image-index';
                indexLabel.textContent = index + 1;
                
                imageItem.appendChild(img);
                imageItem.appendChild(indexLabel);
                imageList.appendChild(imageItem);
            });
        }
        
        // æ˜¾ç¤ºå¤šè§†é¢‘ç»“æœ (æ–°å¢)
        function displayMultiVideoResult(result) {
            currentMultiVideos = result.videos || [];
            selectedVideoIndices.clear();
            
            // æ›´æ–°æ ‡é¢˜å’Œå¹³å°
            document.getElementById('totalVideoCount').textContent = result.totalCount || 0;
            document.getElementById('totalCount').textContent = result.totalCount || 0;
            
            const platformEl = document.getElementById('multiPlatform');
            platformEl.textContent = result.platform || '';
            platformEl.className = 'platform-tag';
            if (result.platform === 'twitter') {
                platformEl.classList.add('platform-twitter');
            }
            
            // æ¸²æŸ“è§†é¢‘åˆ—è¡¨
            const container = document.getElementById('videoListContainer');
            container.innerHTML = '';
            
            currentMultiVideos.forEach((video, index) => {
                const videoCard = createVideoItemCard(video, index);
                container.appendChild(videoCard);
            });
            
            updateSelectedCount();
        }
        
        // åˆ›å»ºè§†é¢‘é¡¹å¡ç‰‡ (æ–°å¢)
        function createVideoItemCard(video, index) {
            const card = document.createElement('div');
            card.className = 'video-item-card';
            card.setAttribute('data-index', index);
            
            const header = document.createElement('div');
            header.className = 'video-item-header';
            
            const indexEl = document.createElement('div');
            indexEl.className = 'video-item-index';
            indexEl.textContent = video.index || (index + 1);
            
            const titleEl = document.createElement('div');
            titleEl.className = 'video-item-title';
            titleEl.textContent = sanitizeText(video.title || `è§†é¢‘ ${index + 1}`);
            
            header.appendChild(indexEl);
            header.appendChild(titleEl);
            
            const meta = document.createElement('div');
            meta.className = 'video-item-meta';
            
            const duration = video.duration ? `æ—¶é•¿: ${formatDuration(video.duration)}` : '';
            const dash = video.isDash ? ' | DASHæ ¼å¼' : '';
            meta.textContent = duration + dash;
            
            card.appendChild(header);
            card.appendChild(meta);
            
            // ç‚¹å‡»é€‰ä¸­/å–æ¶ˆ
            card.addEventListener('click', () => {
                toggleVideoSelection(index);
            });
            
            return card;
        }
        
        // åˆ‡æ¢è§†é¢‘é€‰ä¸­çŠ¶æ€ (æ–°å¢)
        function toggleVideoSelection(index) {
            const card = document.querySelector(`.video-item-card[data-index="${index}"]`);
            
            if (selectedVideoIndices.has(index)) {
                selectedVideoIndices.delete(index);
                card.classList.remove('selected');
            } else {
                selectedVideoIndices.add(index);
                card.classList.add('selected');
            }
            
            updateSelectedCount();
        }
        
        // å…¨é€‰/å–æ¶ˆå…¨é€‰ (æ–°å¢)
        function toggleSelectAll() {
            const btn = document.getElementById('selectAllBtn');
            
            if (selectedVideoIndices.size === currentMultiVideos.length) {
                // å–æ¶ˆå…¨é€‰
                selectedVideoIndices.clear();
                document.querySelectorAll('.video-item-card').forEach(card => {
                    card.classList.remove('selected');
                });
                btn.textContent = 'å…¨é€‰';
            } else {
                // å…¨é€‰
                selectedVideoIndices.clear();
                currentMultiVideos.forEach((_, index) => {
                    selectedVideoIndices.add(index);
                });
                document.querySelectorAll('.video-item-card').forEach(card => {
                    card.classList.add('selected');
                });
                btn.textContent = 'å–æ¶ˆå…¨é€‰';
            }
            
            updateSelectedCount();
        }
        
        // æ›´æ–°é€‰ä¸­æ•°é‡ (æ–°å¢)
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedVideoIndices.size;
            
            const btn = document.getElementById('selectAllBtn');
            if (selectedVideoIndices.size === currentMultiVideos.length && currentMultiVideos.length > 0) {
                btn.textContent = 'å–æ¶ˆå…¨é€‰';
            } else {
                btn.textContent = 'å…¨é€‰';
            }
        }
        
        // ä¸‹è½½é€‰ä¸­çš„è§†é¢‘ (æ–°å¢)
        function downloadSelectedVideos() {
            if (selectedVideoIndices.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦ä¸‹è½½çš„è§†é¢‘');
                return;
            }
            
            const selectedVideos = Array.from(selectedVideoIndices).map(i => currentMultiVideos[i]);
            
            selectedVideos.forEach((video, index) => {
                setTimeout(() => {
                    if (video.videoUrl && isValidUrl(video.videoUrl)) {
                        const title = sanitizeText(video.title || `video_${video.index}`);
                        const link = document.createElement('a');
                        link.href = video.videoUrl;
                        link.download = title;
                        link.target = '_blank';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }, index * MULTI_DOWNLOAD_DELAY_MS);
            });
            
            alert(`å¼€å§‹ä¸‹è½½ ${selectedVideos.length} ä¸ªè§†é¢‘`);
        }
        
        // å¤åˆ¶é€‰ä¸­çš„é“¾æ¥ (æ–°å¢)
        function copySelectedUrls() {
            if (selectedVideoIndices.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦å¤åˆ¶çš„è§†é¢‘');
                return;
            }
            
            const selectedVideos = Array.from(selectedVideoIndices).map(i => currentMultiVideos[i]);
            const urls = selectedVideos
                .map((v, i) => {
                    // æ¸…ç†æ ‡é¢˜ï¼Œç§»é™¤æ¢è¡Œç¬¦å’Œæ§åˆ¶å­—ç¬¦
                    const cleanTitle = sanitizeText(v.title || 'æœªå‘½å').replace(/[\r\n\t]/g, ' ');
                    return `${i + 1}. ${cleanTitle}\n${v.videoUrl}`;
                })
                .join('\n\n');
            
            navigator.clipboard.writeText(urls).then(() => {
                alert(`å·²å¤åˆ¶ ${selectedVideos.length} ä¸ªè§†é¢‘é“¾æ¥`);
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        // è¾…åŠ©å‡½æ•°: æ ¼å¼åŒ–æ—¶é•¿ (æ–°å¢)
        function formatDuration(seconds) {
            if (!seconds) return '';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            if (h > 0) {
                return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            }
            return `${m}:${s.toString().padStart(2, '0')}`;
        }
        
        // URLéªŒè¯å‡½æ•°
        function isValidUrl(urlString) {
            try {
                const url = new URL(urlString);
                // åªå…è®¸ http å’Œ https åè®®
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (e) {
                return false;
            }
        }
        
        // æ–‡æœ¬æ¸…ç†å‡½æ•°
        function sanitizeText(text) {
            if (!text) return '';
            // ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢è·¯å¾„éå†
            return text.replace(/[<>:"\/\\|?*\x00-\x1f]/g, '_');
        }
        
        // ä¸‹è½½åˆ°æœ¬åœ°
        function downloadToLocal() {
            if (!currentParseResult || !currentParseResult.videoUrl) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹');
                return;
            }
            
            const videoUrl = currentParseResult.videoUrl;
            
            // éªŒè¯URL
            if (!isValidUrl(videoUrl)) {
                alert('ä¸‹è½½é“¾æ¥ä¸åˆæ³•');
                return;
            }
            
            const title = sanitizeText(currentParseResult.title || 'media');
            const mediaType = currentParseResult.mediaType || 'video';
            
            // æ ¹æ®åª’ä½“ç±»å‹ç¡®å®šæ–‡ä»¶æ‰©å±•å
            let fileExt = '.mp4';
            if (mediaType === 'audio') {
                fileExt = '.mp3';
            } else if (mediaType === 'image') {
                fileExt = '.jpg';
            }
            
            // åª’ä½“ç±»å‹åç§°æ˜ å°„
            const mediaNameMap = {
                'audio': 'éŸ³é¢‘',
                'image': 'å›¾ç‰‡',
                'video': 'è§†é¢‘'
            };
            const mediaName = mediaNameMap[mediaType] || 'è§†é¢‘';
            
            // å¦‚æœéœ€è¦ refererï¼Œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
            if (currentParseResult.needReferer) {
                window.open(videoUrl, '_blank', 'noopener,noreferrer');
                alert('å·²åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ä¸‹è½½é“¾æ¥ï¼Œè¯·å³é”®ä¿å­˜' + mediaName);
            } else {
                // åˆ›å»ºä¸€ä¸ªéšè—çš„ a æ ‡ç­¾
                const a = document.createElement('a');
                a.href = videoUrl;
                a.download = title + fileExt;
                a.rel = 'noopener noreferrer';
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }
        
        // å¤åˆ¶è§†é¢‘é“¾æ¥
        function copyVideoUrl() {
            if (!currentParseResult || !currentParseResult.videoUrl) {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„é“¾æ¥');
                return;
            }
            
            const videoUrl = currentParseResult.videoUrl;
            
            // éªŒè¯URL
            if (!isValidUrl(videoUrl)) {
                alert('è§†é¢‘é“¾æ¥ä¸åˆæ³•');
                return;
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(videoUrl).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(err => {
                // å…¼å®¹æ—§æµè§ˆå™¨
                const textarea = document.createElement('textarea');
                textarea.value = videoUrl;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶: ' + videoUrl);
                }
                document.body.removeChild(textarea);
            });
        }
        
        // è°ƒæ•´è§†é¢‘å®¹å™¨
        function adjustVideoContainer() {
            const videoFrame = document.getElementById('videoFrame');
            const container = videoFrame.closest('.video-container');
            
            if (videoFrame.videoWidth && videoFrame.videoHeight) {
                const aspectRatio = videoFrame.videoWidth / videoFrame.videoHeight;
                
                if (aspectRatio > 1) {
                    // æ¨ªå±è§†é¢‘
                    container.classList.add('landscape');
                    container.classList.remove('portrait');
                } else {
                    // ç«–å±è§†é¢‘
                    container.classList.add('portrait');
                    container.classList.remove('landscape');
                }
            }
        }
        
        // æ¸…ç†è¿‡æœŸå†å²è®°å½•
        function cleanupExpiredHistory() {
            const history = JSON.parse(localStorage.getItem('playHistory') || '[]');
            const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
            
            const validHistory = history.filter(item => item.timestamp > oneWeekAgo);
            localStorage.setItem('playHistory', JSON.stringify(validHistory));
        }
        
        // ä¿å­˜æ’­æ”¾å†å²
        function savePlayHistory(videoInfo) {
            cleanupExpiredHistory();
            
            const history = JSON.parse(localStorage.getItem('playHistory') || '[]');
            const existingIndex = history.findIndex(item => item.id === videoInfo.id);
            
            const historyItem = {
                id: videoInfo.id,
                title: videoInfo.videoname || videoInfo.title,
                platform: videoInfo.videoplatform || videoInfo.platform,
                cover: videoInfo.videocover || videoInfo.cover,
                timestamp: Date.now()
            };
            
            if (existingIndex >= 0) {
                history[existingIndex] = historyItem;
            } else {
                history.unshift(historyItem);
            }
            
            // åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
            if (history.length > 50) {
                history.splice(50);
            }
            
            localStorage.setItem('playHistory', JSON.stringify(history));
        }
        
        // åŠ è½½æ’­æ”¾è¿›åº¦
        function loadPlayProgress() {
            if (!currentVideoId) return;
            
            const progress = localStorage.getItem(`progress_${currentVideoId}`);
            if (progress) {
                const videoFrame = document.getElementById('videoFrame');
                videoFrame.currentTime = parseFloat(progress);
            }
        }
        
        // ä¿å­˜æ’­æ”¾è¿›åº¦
        function savePlayProgress() {
            if (!currentVideoId) return;
            
            const videoFrame = document.getElementById('videoFrame');
            if (videoFrame.currentTime > 0 && videoFrame.duration > 0) {
                // åªåœ¨æ’­æ”¾è¶…è¿‡5ç§’ä¸”æœªæ¥è¿‘ç»“å°¾æ—¶ä¿å­˜è¿›åº¦
                if (videoFrame.currentTime > 5 && (videoFrame.duration - videoFrame.currentTime) > 10) {
                    localStorage.setItem(`progress_${currentVideoId}`, videoFrame.currentTime.toString());
                }
            }
        }
        
        // æ¸…é™¤æ’­æ”¾è¿›åº¦
        function clearPlayProgress() {
            if (currentVideoId) {
                localStorage.removeItem(`progress_${currentVideoId}`);
            }
        }

    </script>
</body>

</html>
